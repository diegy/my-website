<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PromptCraft - AIæç¤ºè¯ç”Ÿæˆå™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-input: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #475569;
            --success: #10b981;
            --warning: #f59e0b;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 0;
        }

        header h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 10px;
            vertical-align: middle;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }

        @media (max-width: 968px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .card-header h2 {
            font-size: 1.25rem;
            color: var(--text-primary);
        }

        .icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .icon-input {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }

        .icon-output {
            background: linear-gradient(135deg, var(--accent), var(--primary));
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-bottom: 8px;
            font-weight: 500;
        }

        textarea, select, input[type="text"] {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s;
            font-family: inherit;
        }

        textarea {
            min-height: 160px;
            resize: vertical;
        }

        textarea:focus, select:focus, input[type="text"]:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .quick-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .tag {
            background: var(--bg-input);
            color: var(--text-secondary);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid var(--border);
        }

        .tag:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 28px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .output-container {
            position: relative;
        }

        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .output-meta {
            display: flex;
            gap: 16px;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .output-meta span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .output-box {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            min-height: 300px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.95rem;
            line-height: 1.8;
            white-space: pre-wrap;
            word-break: break-word;
            overflow-x: auto;
        }

        .output-box:empty::before {
            content: "ç”Ÿæˆçš„æç¤ºè¯å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...";
            color: var(--text-secondary);
            font-style: italic;
        }

        .output-actions {
            display: flex;
            gap: 12px;
            margin-top: 16px;
        }

        .btn-secondary {
            background: var(--bg-input);
            color: var(--text-primary);
            border: 1px solid var(--border);
            flex: 1;
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .section-label {
            color: var(--accent);
            font-weight: 600;
            margin-top: 16px;
            margin-bottom: 8px;
            display: block;
        }

        .section-label:first-of-type {
            margin-top: 0;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        @media (max-width: 1200px) {
            .feature-grid {
                grid-template-columns: 1fr;
            }
        }

        .feature-card {
            background: var(--bg-input);
            padding: 16px;
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .feature-card h4 {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .feature-card p {
            font-size: 0.9375rem;
            color: var(--text-primary);
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--success);
            color: white;
            padding: 16px 24px;
            border-radius: 10px;
            font-weight: 500;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .analysis-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .analysis-badge {
            background: rgba(99, 102, 241, 0.2);
            color: var(--primary);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
        }

        .tips-box {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), rgba(99, 102, 241, 0.1));
            border: 1px solid var(--primary);
            border-radius: 12px;
            padding: 20px;
            margin-top: 24px;
        }

        .tips-box h3 {
            font-size: 1rem;
            color: var(--accent);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tips-box ul {
            list-style: none;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .tips-box li {
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
        }

        .tips-box li::before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: var(--primary);
        }

        .template-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .template-btn {
            padding: 12px;
            background: var(--bg-input);
            border: 2px solid var(--border);
            border-radius: 10px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 0.875rem;
        }

        .template-btn.active, .template-btn:hover {
            border-color: var(--primary);
            color: var(--text-primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .hidden {
            display: none !important;
        }

        /* åŠ¨ç”»æ•ˆæœ */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .highlight {
            background: rgba(99, 102, 241, 0.3);
            padding: 2px 6px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>PromptCraft <span class="badge">å†…ç½®å¼•æ“ æ— éœ€API</span></h1>
            <p>å°†æ¨¡ç³Šæƒ³æ³•è½¬åŒ–ä¸ºAIå¯æ‰§è¡Œçš„ç»“æ„åŒ–æç¤ºè¯</p>
        </header>

        <div class="main-layout">
            <!-- å·¦ä¾§è¾“å…¥åŒº -->
            <div class="card">
                <div class="card-header">
                    <div class="icon icon-input">âœï¸</div>
                    <h2>æè¿°ä½ çš„éœ€æ±‚</h2>
                </div>

                <div class="template-selector">
                    <button class="template-btn active" data-template="general">é€šç”¨åœºæ™¯</button>
                    <button class="template-btn" data-template="coding">ç¼–ç¨‹å¼€å‘</button>
                    <button class="template-btn" data-template="writing">å†…å®¹åˆ›ä½œ</button>
                    <button class="template-btn" data-template="analysis">æ•°æ®åˆ†æ</button>
                </div>

                <div class="input-group">
                    <label>ä»»åŠ¡ç±»å‹</label>
                    <select id="taskType">
                        <option value="generate">ç”Ÿæˆå†…å®¹</option>
                        <option value="analyze">åˆ†æå¤„ç†</option>
                        <option value="transform">è½¬æ¢æ ¼å¼</option>
                        <option value="answer">å›ç­”é—®é¢˜</option>
                        <option value="optimize">ä¼˜åŒ–æ”¹è¿›</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>ç”¨æ—¥å¸¸è¯­è¨€æè¿°ä½ æƒ³è®©AIåšä»€ä¹ˆ</label>
                    <textarea id="userInput" placeholder="ä¾‹å¦‚ï¼šæˆ‘æƒ³å†™ä¸€ä¸ªç¨‹åºæ¥è‡ªåŠ¨æ•´ç†æˆ‘çš„ç”µè„‘æ–‡ä»¶ï¼ŒæŠŠä¸åŒç±»å‹çš„æ–‡ä»¶æ”¾åˆ°ä¸åŒçš„æ–‡ä»¶å¤¹é‡Œ..."></textarea>
                    <div class="quick-tags">
                        <span class="tag" onclick="insertExample('writing')">ğŸ“ å†™ä¸€ç¯‡æ–‡ç« </span>
                        <span class="tag" onclick="insertExample('coding')">ğŸ’» å†™ä»£ç </span>
                        <span class="tag" onclick="insertExample('analysis')">ğŸ“Š åˆ†ææ•°æ®</span>
                        <span class="tag" onclick="insertExample('explain')">â“ è§£é‡Šæ¦‚å¿µ</span>
                    </div>
                </div>

                <div class="input-group">
                    <label>å…³é”®çº¦æŸæˆ–è¦æ±‚ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="text" id="constraints" placeholder="å¦‚ï¼šé¢„ç®—é™åˆ¶ã€æ—¶é—´è¦æ±‚ã€ç‰¹å®šæ ¼å¼ç­‰">
                </div>

                <div class="feature-grid">
                    <div class="feature-card">
                        <h4>ğŸ¯ ç›®æ ‡å—ä¼—</h4>
                        <input type="text" id="audience" placeholder="å¦‚ï¼šåˆå­¦è€…ã€ä¸“ä¸šäººå£«" style="background: transparent; border: none; padding: 0; color: var(--text-primary);">
                    </div>
                    <div class="feature-card">
                        <h4>ğŸ“ è¾“å‡ºé•¿åº¦</h4>
                        <select id="length" style="background: transparent; border: none; padding: 0;">
                            <option value="concise">ç®€æ´</option>
                            <option value="medium" selected>é€‚ä¸­</option>
                            <option value="detailed">è¯¦ç»†</option>
                        </select>
                    </div>
                    <div class="feature-card">
                        <h4>ğŸ¨ è¯­æ°”é£æ ¼</h4>
                        <select id="tone" style="background: transparent; border: none; padding: 0;">
                            <option value="professional">ä¸“ä¸šæ­£å¼</option>
                            <option value="casual" selected>è‡ªç„¶å‹å¥½</option>
                            <option value="humorous">è½»æ¾å¹½é»˜</option>
                        </select>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="generatePrompt()" id="generateBtn">
                    <span>âœ¨</span> ç”Ÿæˆç»“æ„åŒ–æç¤ºè¯
                </button>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>åˆ†æéœ€æ±‚ç»“æ„...</p>
                    <p style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 8px;">åŸºäºå†…ç½®è§„åˆ™å¼•æ“ä¼˜åŒ–ä¸­</p>
                </div>
            </div>

            <!-- å³ä¾§è¾“å‡ºåŒº -->
            <div class="card">
                <div class="card-header">
                    <div class="icon icon-output">ğŸ¯</div>
                    <h2>ä¼˜åŒ–åçš„æç¤ºè¯</h2>
                </div>

                <div class="output-container" id="outputContainer" style="display: none;">
                    <div class="output-header">
                        <div class="output-meta">
                            <span>ğŸ“Š <span id="tokenEstimate">0</span> tokens</span>
                            <span>ğŸ¯ åŒ¹é…åº¦: <span id="matchScore">0</span>%</span>
                        </div>
                    </div>
                    <div class="analysis-badges" id="analysisBadges"></div>
                    <div class="output-box" id="outputBox"></div>
                    <div class="output-actions">
                        <button class="btn btn-secondary" onclick="copyOutput()">
                            <span>ğŸ“‹</span> å¤åˆ¶
                        </button>
                        <button class="btn btn-secondary" onclick="refinePrompt()">
                            <span>ğŸ”§</span> è¿›ä¸€æ­¥ä¼˜åŒ–
                        </button>
                        <button class="btn btn-secondary" onclick="savePrompt()">
                            <span>ğŸ’¾</span> ä¿å­˜
                        </button>
                    </div>
                </div>

                <div class="tips-box">
                    <h3>ğŸ’¡ ä¸ºä»€ä¹ˆè¿™æ ·ä¼˜åŒ–ï¼Ÿ</h3>
                    <ul id="tipsList">
                        <li>æ¸…æ™°çš„è§’è‰²å®šä¹‰è®©AIçŸ¥é“ä»¥ä»€ä¹ˆèº«ä»½å›ç­”</li>
                        <li>å…·ä½“çš„è¾“å‡ºæ ¼å¼è¦æ±‚ç¡®ä¿ç»“æœå¯ç”¨</li>
                        <li>çº¦æŸæ¡ä»¶å¸®åŠ©AIèšç„¦é‡ç‚¹ï¼Œé¿å…è·‘é¢˜</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼</div>

    <script>
        // ç¤ºä¾‹æ¨¡æ¿åº“
        const examples = {
            writing: 'æˆ‘éœ€è¦å†™ä¸€ç¯‡å…³äº"è¿œç¨‹å·¥ä½œå¯¹å›¢é˜Ÿåä½œçš„å½±å“"çš„æ–‡ç« ï¼Œç”¨äºå‘è¡¨åœ¨ç§‘æŠ€åšå®¢ä¸Šã€‚å¸Œæœ›æœ‰æ•°æ®æ”¯æ’‘ï¼Œç»“æ„æ¸…æ™°ã€‚',
            coding: 'å¸®æˆ‘å†™ä¸€ä¸ªPythonè„šæœ¬ï¼Œèƒ½å¤Ÿæ‰¹é‡é‡å‘½åæ–‡ä»¶å¤¹é‡Œçš„å›¾ç‰‡ï¼ŒæŒ‰ç…§æ‹æ‘„æ—¥æœŸæ’åºå¹¶æ·»åŠ åºå·å‰ç¼€ã€‚',
            analysis: 'æˆ‘æœ‰ä¸€ä»½é”€å”®æ•°æ®ï¼Œæƒ³åˆ†æå“ªäº›äº§å“ç»„åˆç»å¸¸ä¸€èµ·è¢«è´­ä¹°ï¼Œæ‰¾å‡ºå…³è”è§„åˆ™ç”¨äºæ¨èç³»ç»Ÿã€‚',
            explain: 'ç”¨é€šä¿—æ˜“æ‡‚çš„æ–¹å¼è§£é‡Šä»€ä¹ˆæ˜¯åŒºå—é“¾æŠ€æœ¯ï¼Œè®©å®Œå…¨ä¸æ‡‚æŠ€æœ¯çš„äººä¹Ÿèƒ½ç†è§£å®ƒçš„ä½œç”¨å’ŒåŸç†ã€‚'
        };

        // æç¤ºè¯æ¨¡æ¿åº“
        const promptTemplates = {
            general: {
                role: "ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„{task}åŠ©æ‰‹ï¼Œæ“…é•¿å°†å¤æ‚é—®é¢˜è½¬åŒ–ä¸ºæ¸…æ™°å¯æ‰§è¡Œçš„æ–¹æ¡ˆã€‚",
                structure: [
                    "ã€è§’è‰²ã€‘{role}",
                    "ã€ä»»åŠ¡ã€‘{task_desc}",
                    "ã€èƒŒæ™¯ã€‘{context}",
                    "ã€è¦æ±‚ã€‘\n{requirements}",
                    "ã€è¾“å‡ºæ ¼å¼ã€‘\n{format}",
                    "ã€çº¦æŸæ¡ä»¶ã€‘\n{constraints}"
                ]
            },
            coding: {
                role: "ä½ æ˜¯ä¸€ä½ç»éªŒä¸°å¯Œçš„è½¯ä»¶å·¥ç¨‹å¸ˆï¼Œç²¾é€šå¤šç§ç¼–ç¨‹è¯­è¨€å’Œæœ€ä½³å®è·µã€‚",
                structure: [
                    "# ç¼–ç¨‹ä»»åŠ¡",
                    "",
                    "## éœ€æ±‚æè¿°",
                    "{task_desc}",
                    "",
                    "## æŠ€æœ¯è§„æ ¼",
                    "- è¯­è¨€/æ¡†æ¶: {tech_stack}",
                    "- ä»£ç é£æ ¼: {code_style}",
                    "",
                    "## åŠŸèƒ½è¦æ±‚",
                    "{requirements}",
                    "",
                    "## çº¦æŸæ¡ä»¶",
                    "{constraints}",
                    "",
                    "## æœŸæœ›è¾“å‡º",
                    "{format}",
                    "",
                    "è¯·æä¾›å®Œæ•´çš„ã€å¯ç›´æ¥è¿è¡Œçš„ä»£ç ï¼Œå¹¶åŒ…å«å¿…è¦çš„æ³¨é‡Šã€‚"
                ]
            },
            writing: {
                role: "ä½ æ˜¯ä¸€ä½èµ„æ·±å†…å®¹åˆ›ä½œè€…ï¼Œæ“…é•¿æ’°å†™å¼•äººå…¥èƒœä¸”ç»“æ„ä¸¥è°¨çš„æ–‡ç« ã€‚",
                structure: [
                    "# å†…å®¹åˆ›ä½œä»»åŠ¡",
                    "",
                    "## ä¸»é¢˜",
                    "{task_desc}",
                    "",
                    "## ç›®æ ‡å—ä¼—",
                    "{audience}",
                    "",
                    "## é£æ ¼è¦æ±‚",
                    "- è¯­æ°”: {tone}",
                    "- é•¿åº¦: {length}",
                    "",
                    "## å†…å®¹ç»“æ„",
                    "{structure}",
                    "",
                    "## ç‰¹æ®Šè¦æ±‚",
                    "{constraints}"
                ]
            },
            analysis: {
                role: "ä½ æ˜¯ä¸€ä½æ•°æ®åˆ†æä¸“å®¶ï¼Œå–„äºä»æ•°æ®ä¸­å‘ç°æ´å¯Ÿå¹¶æå‡º actionable çš„å»ºè®®ã€‚",
                structure: [
                    "# æ•°æ®åˆ†æä»»åŠ¡",
                    "",
                    "## åˆ†æç›®æ ‡",
                    "{task_desc}",
                    "",
                    "## æ•°æ®èƒŒæ™¯",
                    "{context}",
                    "",
                    "## åˆ†ææ–¹æ³•",
                    "{methodology}",
                    "",
                    "## æœŸæœ›è¾“å‡º",
                    "{format}",
                    "",
                    "## é™åˆ¶æ¡ä»¶",
                    "{constraints}"
                ]
            }
        };

        // ä»»åŠ¡ç±»å‹æ˜ å°„
        const taskTypeMap = {
            generate: "å†…å®¹ç”Ÿæˆ",
            analyze: "åˆ†æå¤„ç†",
            transform: "æ ¼å¼è½¬æ¢",
            answer: "é—®é¢˜è§£ç­”",
            optimize: "ä¼˜åŒ–æ”¹è¿›"
        };

        // è¯­æ°”æ˜ å°„
        const toneMap = {
            professional: "ä¸“ä¸šæ­£å¼ï¼Œä½¿ç”¨è¡Œä¸šæœ¯è¯­ï¼Œç»“æ„ä¸¥è°¨",
            casual: "è‡ªç„¶å‹å¥½ï¼Œé€šä¿—æ˜“æ‡‚ï¼Œåƒæœ‹å‹äº¤è°ˆ",
            humorous: "è½»æ¾å¹½é»˜ï¼Œé€‚å½“ä½¿ç”¨æ¯”å–»å’Œä¿çš®è¯"
        };

        // é•¿åº¦æ˜ å°„
        const lengthMap = {
            concise: "ç®€æ´ç²¾ç‚¼ï¼Œçªå‡ºé‡ç‚¹ï¼Œæ§åˆ¶åœ¨300å­—ä»¥å†…",
            medium: "å†…å®¹å……å®ï¼Œè¯¦ç•¥å¾—å½“ï¼Œçº¦500-800å­—",
            detailed: "å…¨é¢è¯¦ç»†ï¼Œæ·±å…¥åˆ†æï¼Œ1000å­—ä»¥ä¸Š"
        };

        // æ¨¡æ¿åˆ‡æ¢
        document.querySelectorAll('.template-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.template-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // æ’å…¥ç¤ºä¾‹
        function insertExample(type) {
            document.getElementById('userInput').value = examples[type];
            document.getElementById('userInput').focus();
        }

        // æ ¸å¿ƒç”Ÿæˆé€»è¾‘ - åŸºäºè§„åˆ™çš„æç¤ºè¯å¼•æ“
        function generatePrompt() {
            const input = document.getElementById('userInput').value.trim();
            if (!input) {
                showToast('è¯·å…ˆæè¿°ä½ çš„éœ€æ±‚', 'warning');
                return;
            }

            const btn = document.getElementById('generateBtn');
            const loading = document.getElementById('loading');
            const outputContainer = document.getElementById('outputContainer');
            
            btn.disabled = true;
            loading.classList.add('active');
            outputContainer.style.display = 'none';

            // æ¨¡æ‹Ÿå¤„ç†æ—¶é—´ï¼Œå¢å¼ºä½“éªŒ
            setTimeout(() => {
                const result = buildPrompt(input);
                displayResult(result);
                
                loading.classList.remove('active');
                btn.disabled = false;
                outputContainer.style.display = 'block';
                outputContainer.classList.add('fade-in');
            }, 800);
        }

        // æç¤ºè¯æ„å»ºå¼•æ“
        function buildPrompt(userInput) {
            const templateType = document.querySelector('.template-btn.active').dataset.template;
            const taskType = document.getElementById('taskType').value;
            const constraints = document.getElementById('constraints').value;
            const audience = document.getElementById('audience').value;
            const length = document.getElementById('length').value;
            const tone = document.getElementById('tone').value;

            // åˆ†æç”¨æˆ·è¾“å…¥ï¼Œæå–å…³é”®ä¿¡æ¯
            const analysis = analyzeInput(userInput);
            
            // é€‰æ‹©æ¨¡æ¿
            const template = promptTemplates[templateType] || promptTemplates.general;
            
            // æ„å»ºå˜é‡æ˜ å°„
            const variables = {
                task: taskTypeMap[taskType],
                task_desc: userInput,
                role: template.role.replace('{task}', taskTypeMap[taskType]),
                context: analysis.context || "ç”¨æˆ·éœ€è¦å®Œæˆä¸€ä¸ª" + taskTypeMap[taskType] + "ä»»åŠ¡",
                requirements: buildRequirements(analysis, taskType),
                format: buildFormat(taskType, length),
                constraints: constraints || "æ— ç‰¹æ®Šçº¦æŸ",
                tech_stack: analysis.techStack || "æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ ˆ",
                code_style: "æ¸…æ™°ã€å¯è¯»ã€éµå¾ªæœ€ä½³å®è·µ",
                audience: audience || "ä¸€èˆ¬è¯»è€…",
                tone: toneMap[tone],
                length: lengthMap[length],
                structure: buildStructure(analysis),
                methodology: "æ ¹æ®æ•°æ®ç‰¹å¾é€‰æ‹©é€‚å½“çš„ç»Ÿè®¡æˆ–æœºå™¨å­¦ä¹ æ–¹æ³•"
            };

            // ç»„è£…æœ€ç»ˆæç¤ºè¯
            let output = template.structure.join('\n');
            for (const [key, value] of Object.entries(variables)) {
                output = output.replace(new RegExp(`{${key}}`, 'g'), value);
            }

            return {
                prompt: output,
                analysis: analysis,
                stats: {
                    tokens: estimateTokens(output),
                    matchScore: calculateMatchScore(analysis)
                }
            };
        }

        // è¾“å…¥åˆ†æå¼•æ“
        function analyzeInput(input) {
            const analysis = {
                context: "",
                keyPoints: [],
                techStack: "",
                hasData: false,
                hasExample: false,
                urgency: false
            };

            // æŠ€æœ¯æ ˆæ£€æµ‹
            const techPatterns = {
                python: /python|py/i,
                javascript: /javascript|js|node/i,
                java: /\bjava\b/i,
                react: /react/i,
                sql: /sql|æ•°æ®åº“/i,
                api: /api|æ¥å£/i
            };

            for (const [tech, pattern] of Object.entries(techPatterns)) {
                if (pattern.test(input)) {
                    analysis.techStack = tech;
                    break;
                }
            }

            // æ•°æ®æåŠæ£€æµ‹
            if (/æ•°æ®|è¡¨æ ¼|excel|csv|ç»Ÿè®¡|åˆ†æ/.test(input)) {
                analysis.hasData = true;
                analysis.keyPoints.push("æ¶‰åŠæ•°æ®å¤„ç†");
            }

            // ç¤ºä¾‹æåŠæ£€æµ‹
            if (/ä¾‹å¦‚|æ¯”å¦‚|åƒ|ç¤ºä¾‹/.test(input)) {
                analysis.hasExample = true;
            }

            // æ—¶é—´ç´§è¿«æ€§æ£€æµ‹
            if (/ç´§æ€¥|å°½å¿«|é©¬ä¸Š|ä»Šå¤©|ç«‹åˆ»/.test(input)) {
                analysis.urgency = true;
                analysis.keyPoints.push("æ—¶é—´æ•æ„Ÿ");
            }

            // ç”Ÿæˆä¸Šä¸‹æ–‡æè¿°
            analysis.context = generateContext(input, analysis);

            return analysis;
        }

        // ç”Ÿæˆä¸Šä¸‹æ–‡
        function generateContext(input, analysis) {
            const contexts = [];
            
            if (analysis.techStack) {
                contexts.push(`æ¶‰åŠ${analysis.techStack}æŠ€æœ¯å®ç°`);
            }
            if (analysis.hasData) {
                contexts.push("éœ€è¦å¤„ç†å’Œåˆ†ææ•°æ®");
            }
            if (analysis.urgency) {
                contexts.push("æ—¶é—´è¦æ±‚è¾ƒç´§");
            }
            
            return contexts.length > 0 ? contexts.join("ï¼Œ") : "æ ‡å‡†ä»»åŠ¡åœºæ™¯";
        }

        // æ„å»ºè¦æ±‚åˆ—è¡¨
        function buildRequirements(analysis, taskType) {
            const requirements = [];
            
            if (taskType === 'generate') {
                requirements.push("- å†…å®¹åŸåˆ›ï¼Œé¿å…é™ˆè¯æ»¥è°ƒ");
                requirements.push("- ç»“æ„æ¸…æ™°ï¼Œé€»è¾‘è¿è´¯");
            } else if (taskType === 'analyze') {
                requirements.push("- æä¾›æ·±å…¥çš„åˆ†æå’Œæ´å¯Ÿ");
                requirements.push("- ç”¨æ•°æ®æˆ–æ¡ˆä¾‹æ”¯æ’‘è§‚ç‚¹");
            } else if (taskType === 'coding') {
                requirements.push("- ä»£ç å¯è¯»æ€§å¼ºï¼Œå‘½åè§„èŒƒ");
                requirements.push("- åŒ…å«å¿…è¦çš„é”™è¯¯å¤„ç†");
            }
            
            if (analysis.hasData) {
                requirements.push("- åŸºäºæä¾›çš„æ•°æ®è¿›è¡Œåˆ†æ");
            }
            
            return requirements.join('\n');
        }

        // æ„å»ºè¾“å‡ºæ ¼å¼
        function buildFormat(taskType, length) {
            const formats = {
                generate: "- æ ‡é¢˜\n- æ­£æ–‡ï¼ˆåˆ†æ®µï¼‰\n- æ€»ç»“",
                analyze: "- æ‰§è¡Œæ‘˜è¦\n- è¯¦ç»†åˆ†æ\n- ç»“è®ºä¸å»ºè®®",
                transform: "- è¾“å…¥ç¤ºä¾‹\n- è¾“å‡ºæ ¼å¼\n- è½¬æ¢è§„åˆ™",
                answer: "- æ ¸å¿ƒè§‚ç‚¹\n- è¯¦ç»†è§£é‡Š\n- ç›¸å…³æ¡ˆä¾‹",
                optimize: "- ç°çŠ¶åˆ†æ\n- ä¼˜åŒ–æ–¹æ¡ˆ\n- å®æ–½æ­¥éª¤"
            };
            
            return formats[taskType] || formats.generate;
        }

        // æ„å»ºå†…å®¹ç»“æ„
        function buildStructure(analysis) {
            if (analysis.hasData) {
                return "1. å¼•è¨€/èƒŒæ™¯\n2. æ•°æ®æ¦‚è§ˆ\n3. æ·±åº¦åˆ†æ\n4. ç»“è®ºä¸å»ºè®®";
            }
            return "1. å¼•å…¥/èƒŒæ™¯\n2. ä¸»ä½“å†…å®¹\n3. æ¡ˆä¾‹åˆ†æ\n4. æ€»ç»“å‡å";
        }

        // ä¼°ç®—tokenæ•°é‡
        function estimateTokens(text) {
            // ä¸­æ–‡æŒ‰å­—è®¡ç®—ï¼Œè‹±æ–‡æŒ‰è¯è®¡ç®—ï¼ˆç®€åŒ–ç®—æ³•ï¼‰
            const chineseChars = (text.match(/[\u4e00-\u9fa5]/g) || []).length;
            const englishWords = (text.match(/[a-zA-Z]+/g) || []).length;
            return Math.ceil(chineseChars + englishWords * 0.5);
        }

        // è®¡ç®—åŒ¹é…åº¦åˆ†æ•°
        function calculateMatchScore(analysis) {
            let score = 85;
            if (analysis.keyPoints.length > 0) score += 5;
            if (analysis.techStack) score += 5;
            if (analysis.hasData) score += 3;
            return Math.min(score, 98);
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResult(result) {
            document.getElementById('outputBox').textContent = result.prompt;
            document.getElementById('tokenEstimate').textContent = result.stats.tokens;
            document.getElementById('matchScore').textContent = result.stats.matchScore;
            
            // æ˜¾ç¤ºåˆ†ææ ‡ç­¾
            const badgesContainer = document.getElementById('analysisBadges');
            badgesContainer.innerHTML = '';
            result.analysis.keyPoints.forEach(point => {
                const badge = document.createElement('span');
                badge.className = 'analysis-badge';
                badge.textContent = point;
                badgesContainer.appendChild(badge);
            });
            
            // æ›´æ–°æç¤º
            updateTips(result.analysis);
        }

        // æ›´æ–°æç¤ºåˆ—è¡¨
        function updateTips(analysis) {
            const tips = [
                "æ¸…æ™°çš„è§’è‰²å®šä¹‰è®©AIçŸ¥é“ä»¥ä»€ä¹ˆèº«ä»½å›ç­”",
                "å…·ä½“çš„è¾“å‡ºæ ¼å¼è¦æ±‚ç¡®ä¿ç»“æœå¯ç”¨"
            ];
            
            if (analysis.techStack) {
                tips.push(`é’ˆå¯¹${analysis.techStack}æŠ€æœ¯æ ˆæä¾›äº†ä¸“ä¸šæŒ‡å¯¼`);
            }
            if (analysis.hasData) {
                tips.push("å·²æ·»åŠ æ•°æ®åˆ†æç›¸å…³çš„çº¦æŸæ¡ä»¶");
            }
            if (analysis.urgency) {
                tips.push("é’ˆå¯¹æ—¶é—´ç´§è¿«æ€§ä¼˜åŒ–äº†è¾“å‡ºä¼˜å…ˆçº§");
            }
            
            const tipsList = document.getElementById('tipsList');
            tipsList.innerHTML = tips.map(tip => `<li>${tip}</li>`).join('');
        }

        // å¤åˆ¶åŠŸèƒ½
        function copyOutput() {
            const output = document.getElementById('outputBox').textContent;
            navigator.clipboard.writeText(output).then(() => {
                showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
            });
        }

        // è¿›ä¸€æ­¥ä¼˜åŒ–
        function refinePrompt() {
            const current = document.getElementById('outputBox').textContent;
            const refined = current + '\n\n---\n\nè¡¥å……è¯´æ˜ï¼šè¯·åœ¨å›ç­”å‰ç¡®è®¤æ˜¯å¦ç†è§£éœ€æ±‚ï¼Œå¦‚æœ‰æ­§ä¹‰è¯·æå‡ºæ¾„æ¸…é—®é¢˜ã€‚';
            document.getElementById('outputBox').textContent = refined;
            showToast('å·²æ·»åŠ ä¼˜åŒ–å»ºè®®');
        }

        // ä¿å­˜åŠŸèƒ½ï¼ˆä½¿ç”¨ localStorageï¼‰
        function savePrompt() {
            const output = document.getElementById('outputBox').textContent;
            const saves = JSON.parse(localStorage.getItem('promptCraft_saves') || '[]');
            saves.push({
                content: output,
                timestamp: new Date().toISOString(),
                title: 'æç¤ºè¯ ' + (saves.length + 1)
            });
            localStorage.setItem('promptCraft_saves', JSON.stringify(saves));
            showToast('å·²ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨');
        }

        // æ˜¾ç¤ºæç¤º
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.style.background = type === 'warning' ? 'var(--warning)' : 'var(--success)';
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // å›è½¦å¿«æ·ç”Ÿæˆ
        document.getElementById('userInput').addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                generatePrompt();
            }
        });
    </script>
</body>
</html>