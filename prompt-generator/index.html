<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæç¤ºè¯å·¥åŠ v12 | æ™ºèƒ½ç”Ÿæˆ Â· å‚ç›´åœºæ™¯ Â· æ•ˆæœè¿½è¸ª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #ec4899;
            --accent: #f59e0b;
            --dark: #1e293b;
            --light: #f8fafc;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --xiaohongshu: #ff2442;
            --code: #3b82f6;
            --marketing: #8b5cf6;
            --academic: #059669;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        header h1 span {
            color: #fbbf24;
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        /* å‚ç›´åœºæ™¯é€‰æ‹©å™¨ */
        .scenario-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .scenario-tab {
            padding: 12px 24px;
            border-radius: 12px;
            border: 2px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .scenario-tab:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }
        
        .scenario-tab.active {
            background: white;
            color: var(--dark);
            border-color: white;
        }
        
        .scenario-tab.xiaohongshu.active {
            background: var(--xiaohongshu);
            color: white;
            border-color: var(--xiaohongshu);
        }
        
        .scenario-tab.code.active {
            background: var(--code);
            color: white;
            border-color: var(--code);
        }
        
        .scenario-tab.marketing.active {
            background: var(--marketing);
            color: white;
            border-color: var(--marketing);
        }
        
        .scenario-tab.academic.active {
            background: var(--academic);
            color: white;
            border-color: var(--academic);
        }
        
        /* ä¸»å†…å®¹åŒº */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 24px;
        }
        
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* ç”Ÿæˆé¢æ¿ */
        .generator-panel {
            background: white;
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }
        
        .panel-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #f1f5f9;
        }
        
        .panel-header h3 {
            color: var(--dark);
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .ai-status {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .ai-status.online {
            background: #dcfce7;
            color: #15803d;
        }
        
        .ai-status.offline {
            background: #fee2e2;
            color: #dc2626;
        }
        
        .ai-status::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* è¾“å…¥åŒº */
        .input-section {
            margin-bottom: 20px;
        }
        
        .input-section label {
            display: block;
            margin-bottom: 8px;
            color: var(--dark);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .smart-input {
            width: 100%;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            min-height: 120px;
            transition: all 0.3s ease;
        }
        
        .smart-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }
        
        .smart-input::placeholder {
            color: #94a3b8;
        }
        
        /* ç¤ºä¾‹æç¤º */
        .examples {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }
        
        .example-chip {
            padding: 6px 12px;
            background: #f1f5f9;
            border-radius: 16px;
            font-size: 0.8rem;
            color: #64748b;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }
        
        .example-chip:hover {
            background: #e0e7ff;
            color: var(--primary);
        }
        
        /* å‚æ•°é…ç½® */
        .config-section {
            margin-bottom: 20px;
        }
        
        .config-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        .config-item label {
            display: block;
            margin-bottom: 6px;
            color: #64748b;
            font-size: 0.85rem;
        }
        
        .config-item select,
        .config-item input {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }
        
        .config-item select:focus,
        .config-item input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        /* ç”ŸæˆæŒ‰é’® */
        .generate-btn {
            width: 100%;
            padding: 16px 24px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .generate-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(99, 102, 241, 0.4);
        }
        
        .generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .generate-btn.loading {
            position: relative;
            color: transparent;
        }
        
        .generate-btn.loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 2px solid transparent;
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* ç»“æœé¢æ¿ */
        .result-panel {
            background: white;
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .result-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .result-header h3 {
            color: var(--dark);
            font-size: 1.1rem;
        }
        
        .result-actions {
            display: flex;
            gap: 8px;
        }
        
        .icon-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        
        .icon-btn:hover {
            background: #f1f5f9;
            border-color: var(--primary);
            color: var(--primary);
        }
        
        /* ç”Ÿæˆçš„æç¤ºè¯ */
        .prompt-output {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 12px;
            font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            min-height: 200px;
            white-space: pre-wrap;
            word-break: break-word;
        }
        
        .prompt-output:empty::before {
            content: 'ç”Ÿæˆçš„æç¤ºè¯å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...';
            color: #64748b;
            font-style: italic;
        }
        
        /* åé¦ˆåŒº */
        .feedback-section {
            padding-top: 16px;
            border-top: 1px solid #e2e8f0;
        }
        
        .feedback-title {
            font-size: 0.85rem;
            color: #64748b;
            margin-bottom: 12px;
        }
        
        .feedback-buttons {
            display: flex;
            gap: 10px;
        }
        
        .feedback-btn {
            flex: 1;
            padding: 10px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            background: white;
            cursor: pointer;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s ease;
        }
        
        .feedback-btn:hover {
            transform: translateY(-2px);
        }
        
        .feedback-btn.good {
            color: var(--success);
        }
        
        .feedback-btn.good:hover,
        .feedback-btn.good.selected {
            background: #dcfce7;
            border-color: var(--success);
        }
        
        .feedback-btn.mid {
            color: var(--warning);
        }
        
        .feedback-btn.mid:hover,
        .feedback-btn.mid.selected {
            background: #fef3c7;
            border-color: var(--warning);
        }
        
        .feedback-btn.bad {
            color: var(--danger);
        }
        
        .feedback-btn.bad:hover,
        .feedback-btn.bad.selected {
            background: #fee2e2;
            border-color: var(--danger);
        }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stats-card {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 12px;
            padding: 16px;
        }
        
        .stats-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .stats-title {
            font-size: 0.9rem;
            color: #64748b;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .learning-badge {
            padding: 4px 10px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-radius: 12px;
            font-size: 0.75rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
        }
        
        .stat-item {
            text-align: center;
            padding: 12px;
            background: white;
            border-radius: 10px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .stat-value.good { color: var(--success); }
        .stat-value.mid { color: var(--warning); }
        .stat-value.bad { color: var(--danger); }
        
        .stat-label {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-top: 4px;
        }
        
        /* å†å²è®°å½• */
        .history-section {
            margin-top: 20px;
        }
        
        .history-title {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 12px;
            background: #f8fafc;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }
        
        .history-item:hover {
            background: #e0e7ff;
            border-left-color: var(--primary);
        }
        
        .history-item-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 4px;
        }
        
        .history-item-type {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 500;
        }
        
        .history-item-type.xiaohongshu {
            background: #fee2e2;
            color: var(--xiaohongshu);
        }
        
        .history-item-type.code {
            background: #dbeafe;
            color: var(--code);
        }
        
        .history-item-type.marketing {
            background: #f3e8ff;
            color: var(--marketing);
        }
        
        .history-item-type.academic {
            background: #d1fae5;
            color: var(--academic);
        }
        
        .history-item-type.general {
            background: #e0e7ff;
            color: var(--primary);
        }
        
        .history-item-time {
            font-size: 0.75rem;
            color: #94a3b8;
        }
        
        .history-item-preview {
            font-size: 0.85rem;
            color: #475569;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        /* AIè®¾ç½®é¢æ¿ */
        .settings-panel {
            background: white;
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            margin-top: 24px;
        }
        
        .settings-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #f1f5f9;
        }
        
        .settings-header h3 {
            color: var(--dark);
            font-size: 1.1rem;
        }
        
        .api-input-group {
            display: flex;
            gap: 12px;
        }
        
        .api-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 0.9rem;
            font-family: monospace;
        }
        
        .api-input:focus {
            outline: none;
            border-color: var(--primary);
        }
        
        .api-save-btn {
            padding: 12px 20px;
            background: var(--success);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .api-save-btn:hover {
            background: #059669;
        }
        
        .api-help {
            margin-top: 12px;
            padding: 12px;
            background: #f8fafc;
            border-radius: 8px;
            font-size: 0.85rem;
            color: #64748b;
            line-height: 1.6;
        }
        
        .api-help code {
            background: #e2e8f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }
        
        /* å“åº”å¼ */
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8rem;
            }
            
            .scenario-tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
                padding-bottom: 8px;
            }
            
            .config-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Toastæç¤º */
        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            padding: 12px 24px;
            background: var(--dark);
            color: white;
            border-radius: 10px;
            font-size: 0.9rem;
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        /* æ€ç»´é“¾å±•ç¤º */
        .thinking-chain {
            background: #f8fafc;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            border-left: 4px solid var(--primary);
        }
        
        .thinking-chain h4 {
            color: var(--primary);
            font-size: 0.85rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .thinking-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 8px 0;
            font-size: 0.9rem;
            color: #475569;
        }
        
        .thinking-icon {
            width: 24px;
            height: 24px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            flex-shrink: 0;
        }
        
        .thinking-icon.role { background: #dbeafe; color: #1d4ed8; }
        .thinking-icon.task { background: #dcfce7; color: #15803d; }
        .thinking-icon.constraint { background: #fef3c7; color: #b45309; }
        .thinking-icon.format { background: #f3e8ff; color: #7c3aed; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¯ AIæç¤ºè¯<span>å·¥åŠ</span> v12</h1>
            <p>æ™ºèƒ½ç”Ÿæˆ Â· å‚ç›´åœºæ™¯ Â· æ•ˆæœè¿½è¸ª Â· æ€ç»´é“¾å¯è§†åŒ–</p>
        </header>
        
        <!-- å‚ç›´åœºæ™¯é€‰æ‹© -->
        <div class="scenario-tabs">
            <div class="scenario-tab active" data-scenario="general">
                <span>ğŸ¯</span> é€šç”¨åœºæ™¯
            </div>
            <div class="scenario-tab xiaohongshu" data-scenario="xiaohongshu">
                <span>ğŸ“•</span> å°çº¢ä¹¦æ–‡æ¡ˆ
            </div>
            <div class="scenario-tab code" data-scenario="code">
                <span>ğŸ’»</span> ä»£ç ç”Ÿæˆ
            </div>
            <div class="scenario-tab marketing" data-scenario="marketing">
                <span>ğŸ“¢</span> è¥é”€æ–‡æ¡ˆ
            </div>
            <div class="scenario-tab academic" data-scenario="academic">
                <span>ğŸ“</span> å­¦æœ¯å†™ä½œ
            </div>
        </div>
        
        <div class="main-content">
            <!-- ç”Ÿæˆé¢æ¿ -->
            <div class="generator-panel">
                <div class="panel-header">
                    <h3>
                        <span>âœ¨</span>
                        <span id="panelTitle">æè¿°ä½ çš„éœ€æ±‚</span>
                    </h3>
                    <div class="ai-status online" id="aiStatus">
                        AIå°±ç»ª
                    </div>
                </div>
                
                <!-- æ€ç»´é“¾å±•ç¤º -->
                <div class="thinking-chain" id="thinkingChain" style="display: none;">
                    <h4>ğŸ§  AIæ€è€ƒè¿‡ç¨‹</h4>
                    <div id="thinkingContent"></div>
                </div>
                
                <div class="input-section">
                    <label>è¾“å…¥ä½ çš„æƒ³æ³•ï¼ˆæ”¯æŒè‡ªç„¶è¯­è¨€ï¼‰</label>
                    <textarea 
                        class="smart-input" 
                        id="userInput" 
                        placeholder="ä¾‹å¦‚ï¼šå¸®æˆ‘å†™ä¸€ç¯‡å…³äºæŠ¤è‚¤å“çš„ç§è‰æ–‡æ¡ˆï¼Œè¦çªå‡ºäº§å“ç‰¹ç‚¹ï¼Œè¯­æ°”äº²åˆ‡..."
                    ></textarea>
                    <div class="examples" id="examples">
                        <!-- åŠ¨æ€åŠ è½½ç¤ºä¾‹ -->
                    </div>
                </div>
                
                <div class="config-section">
                    <div class="config-grid">
                        <div class="config-item">
                            <label>è¾“å‡ºé£æ ¼</label>
                            <select id="styleSelect">
                                <option value="professional">ä¸“ä¸šä¸¥è°¨</option>
                                <option value="casual">è½»æ¾éšæ„</option>
                                <option value="creative">åˆ›æ„å‘æ•£</option>
                                <option value="concise">ç®€æ´æ˜äº†</option>
                            </select>
                        </div>
                        <div class="config-item">
                            <label>è¯¦ç»†ç¨‹åº¦</label>
                            <select id="detailSelect">
                                <option value="brief">ç®€è¦</option>
                                <option value="standard" selected>æ ‡å‡†</option>
                                <option value="detailed">è¯¦ç»†</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <button class="generate-btn" id="generateBtn" onclick="generatePrompt()">
                    <span>ğŸš€</span> ç”Ÿæˆä¸“ä¸šæç¤ºè¯
                </button>
            </div>
            
            <!-- ç»“æœé¢æ¿ -->
            <div class="result-panel">
                <div class="result-header">
                    <h3>ğŸ“‹ ç”Ÿæˆç»“æœ</h3>
                    <div class="result-actions">
                        <button class="icon-btn" onclick="copyResult()" title="å¤åˆ¶">
                            ğŸ“‹
                        </button>
                        <button class="icon-btn" onclick="clearResult()" title="æ¸…ç©º">
                            ğŸ—‘ï¸
                        </button>
                    </div>
                </div>
                
                <div class="prompt-output" id="promptOutput"></div>
                
                <div class="feedback-section" id="feedbackSection" style="display: none;">
                    <div class="feedback-title">è¿™ä¸ªæç¤ºè¯æ•ˆæœå¦‚ä½•ï¼Ÿ</div>
                    <div class="feedback-buttons">
                        <button class="feedback-btn good" onclick="submitFeedback('good')">
                            <span>ğŸ˜Š</span> å¾ˆèµ
                        </button>
                        <button class="feedback-btn mid" onclick="submitFeedback('mid')">
                            <span>ğŸ˜</span> ä¸€èˆ¬
                        </button>
                        <button class="feedback-btn bad" onclick="submitFeedback('bad')">
                            <span>ğŸ˜</span> éœ€æ”¹è¿›
                        </button>
                    </div>
                </div>
                
                <!-- ç»Ÿè®¡å¡ç‰‡ -->
                <div class="stats-card">
                    <div class="stats-header">
                        <div class="stats-title">
                            <span>ğŸ“Š</span> æ•ˆæœè¿½è¸ª
                        </div>
                        <span class="learning-badge">âš¡ å®æ—¶å­¦ä¹ </span>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value good" id="statGood">0</div>
                            <div class="stat-label">æ•ˆæœä¼˜ç§€</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value mid" id="statMid">0</div>
                            <div class="stat-label">æ•ˆæœä¸€èˆ¬</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value bad" id="statBad">0</div>
                            <div class="stat-label">éœ€æ”¹è¿›</div>
                        </div>
                    </div>
                </div>
                
                <!-- å†å²è®°å½• -->
                <div class="history-section">
                    <div class="history-title">
                        <span>ğŸ• æœ€è¿‘ç”Ÿæˆ</span>
                        <button class="icon-btn" onclick="clearHistory()" title="æ¸…ç©ºå†å²">
                            ğŸ—‘ï¸
                        </button>
                    </div>
                    <div class="history-list" id="historyList">
                        <!-- åŠ¨æ€åŠ è½½å†å² -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AIè®¾ç½®é¢æ¿ -->
        <div class="settings-panel">
            <div class="settings-header">
                <h3>ğŸ”§ AIè®¾ç½®</h3>
            </div>
            <div class="api-input-group">
                <input 
                    type="password" 
                    class="api-input" 
                    id="apiKeyInput" 
                    placeholder="è¾“å…¥ä½ çš„ OpenAI / Claude / å…¶ä»– AI API Key"
                >
                <button class="api-save-btn" onclick="saveApiKey()">ä¿å­˜</button>
            </div>
            <div class="api-help">
                <strong>æ”¯æŒçš„APIï¼š</strong> OpenAI (gpt-4, gpt-3.5-turbo)ã€Claudeã€Azure OpenAI ç­‰å…¼å®¹ OpenAI æ ¼å¼çš„ APIã€‚<br>
                API Key ä»…å­˜å‚¨åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­ï¼Œä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨ã€‚<br>
                å¦‚æœæ²¡æœ‰ API Keyï¼Œå°†ä½¿ç”¨å†…ç½®çš„æ™ºèƒ½æ¨¡æ¿å¼•æ“ç”Ÿæˆæç¤ºè¯ã€‚
            </div>
        </div>
    </div>
    
    <!-- Toastæç¤º -->
    <div class="toast" id="toast"></div>

    <script>
        // ==================== çŠ¶æ€ç®¡ç† ====================
        const state = {
            currentScenario: 'general',
            isGenerating: false,
            lastGenerated: null,
            feedback: { good: 0, mid: 0, bad: 0 },
            history: [],
            apiKey: localStorage.getItem('ai_api_key') || '',
            thinking: null
        };
        
        // ==================== åœºæ™¯é…ç½® ====================
        const scenarios = {
            general: {
                title: 'æè¿°ä½ çš„éœ€æ±‚',
                placeholder: 'ä¾‹å¦‚ï¼šå¸®æˆ‘å†™ä¸€ç¯‡å…³äºæŠ¤è‚¤å“çš„ç§è‰æ–‡æ¡ˆï¼Œè¦çªå‡ºäº§å“ç‰¹ç‚¹ï¼Œè¯­æ°”äº²åˆ‡è‡ªç„¶...',
                examples: [
                    'å¸®æˆ‘å†™ä¸€ä»½å‘¨æŠ¥ï¼Œæ€»ç»“æœ¬å‘¨å·¥ä½œè¿›å±•',
                    'åˆ†æè¿™ä»½é”€å”®æ•°æ®ï¼Œæ‰¾å‡ºå¢é•¿æœºä¼š',
                    'å¸®æˆ‘å‡†å¤‡ä¸€åœºäº§å“å‘å¸ƒä¼šçš„æ¼”è®²ç¨¿'
                ],
                systemPrompt: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æç¤ºè¯å·¥ç¨‹å¸ˆï¼Œæ“…é•¿å°†ç”¨æˆ·çš„éœ€æ±‚è½¬åŒ–ä¸ºç»“æ„æ¸…æ™°ã€æ•ˆæœä¼˜ç§€çš„AIæç¤ºè¯ã€‚'
            },
            xiaohongshu: {
                title: 'å°çº¢ä¹¦æ–‡æ¡ˆç”Ÿæˆ',
                placeholder: 'ä¾‹å¦‚ï¼šä¸€æ¬¾ä¸»æ‰“ä¿æ¹¿çš„é¢éœœï¼Œç›®æ ‡ç”¨æˆ·æ˜¯20-30å²å¥³æ€§ï¼Œæƒ³è¦çªå‡ºæ€§ä»·æ¯”...',
                examples: [
                    'ä¸€æ¬¾å¹³ä»·å¥½ç”¨çš„é˜²æ™’éœœï¼Œå­¦ç”Ÿå…šå¿…å¤‡',
                    'åˆ†äº«æˆ‘çš„æ—©Cæ™šAæŠ¤è‚¤routine',
                    'æ¢åº—ä¸€å®¶è—åœ¨å··å­é‡Œçš„å®è—å’–å•¡é¦†'
                ],
                systemPrompt: 'ä½ æ˜¯å°çº¢ä¹¦çˆ†æ¬¾æ–‡æ¡ˆä¸“å®¶ï¼Œæ“…é•¿åˆ›ä½œçœŸå®ã€äº²åˆ‡ã€æœ‰æ„ŸæŸ“åŠ›çš„ç§è‰æ–‡æ¡ˆã€‚æ‡‚å¾—è¿ç”¨emojiã€åˆ†æ®µã€å…³é”®è¯ç­‰æŠ€å·§æå‡å†…å®¹å¸å¼•åŠ›ã€‚'
            },
            code: {
                title: 'ä»£ç ç”ŸæˆåŠ©æ‰‹',
                placeholder: 'ä¾‹å¦‚ï¼šå†™ä¸€ä¸ªPythonè„šæœ¬ï¼Œæ‰¹é‡å¤„ç†Excelæ–‡ä»¶ï¼Œæå–ç‰¹å®šåˆ—çš„æ•°æ®å¹¶ç”ŸæˆæŠ¥è¡¨...',
                examples: [
                    'ç”¨Reactå†™ä¸€ä¸ªå¸¦æœç´¢åŠŸèƒ½çš„ä¸‹æ‹‰ç»„ä»¶',
                    'Pythonçˆ¬è™«æŠ“å–ç½‘é¡µè¡¨æ ¼æ•°æ®',
                    'SQLæŸ¥è¯¢æ‰¾å‡ºæœ€è¿‘30å¤©æ´»è·ƒç”¨æˆ·'
                ],
                systemPrompt: 'ä½ æ˜¯èµ„æ·±å…¨æ ˆå·¥ç¨‹å¸ˆï¼Œæ“…é•¿ç¼–å†™æ¸…æ™°ã€é«˜æ•ˆã€å¯ç»´æŠ¤çš„ä»£ç ã€‚ä¼šæä¾›å®Œæ•´çš„ä»£ç å®ç°ã€æ³¨é‡Šè¯´æ˜å’Œä½¿ç”¨ç¤ºä¾‹ã€‚'
            },
            marketing: {
                title: 'è¥é”€æ–‡æ¡ˆåˆ›ä½œ',
                placeholder: 'ä¾‹å¦‚ï¼šä¸ºä¸€æ¬¾æ–°æ¨å‡ºçš„æ™ºèƒ½æ‰‹è¡¨å†™æ¨å¹¿æ–‡æ¡ˆï¼Œå¼ºè°ƒå¥åº·ç›‘æµ‹åŠŸèƒ½ï¼Œé¢å‘ä¸­å¹´èŒåœºäººç¾¤...',
                examples: [
                    'æ–°å“ä¸Šå¸‚çš„ç¤¾äº¤åª’ä½“æ¨å¹¿æ–¹æ¡ˆ',
                    'ä¸€å°æé«˜è½¬åŒ–ç‡çš„ä¿ƒé”€é‚®ä»¶',
                    'å“ç‰Œæ•…äº‹æ–‡æ¡ˆï¼Œçªå‡ºåŒ å¿ƒç²¾ç¥'
                ],
                systemPrompt: 'ä½ æ˜¯èµ„æ·±è¥é”€æ–‡æ¡ˆç­–åˆ’ï¼Œæ·±è°™æ¶ˆè´¹è€…å¿ƒç†ï¼Œæ“…é•¿åˆ›ä½œæœ‰è¯´æœåŠ›ã€èƒ½å¼•å‘å…±é¸£çš„è¥é”€æ–‡æ¡ˆã€‚'
            },
            academic: {
                title: 'å­¦æœ¯å†™ä½œåŠ©æ‰‹',
                placeholder: 'ä¾‹å¦‚ï¼šå¸®æˆ‘å†™ä¸€ç¯‡å…³äºæœºå™¨å­¦ä¹ çš„æ–‡çŒ®ç»¼è¿°ï¼Œéœ€è¦æ¶µç›–è¿‘5å¹´çš„ç ”ç©¶è¿›å±•...',
                examples: [
                    'æ’°å†™ç ”ç©¶è®ºæ–‡çš„å¼•è¨€éƒ¨åˆ†',
                    'æ¶¦è‰²è¿™æ®µè‹±æ–‡æ‘˜è¦ï¼Œä½¿å…¶æ›´ç¬¦åˆå­¦æœ¯è§„èŒƒ',
                    'ç”Ÿæˆä¸€ä»½é—®å·è°ƒæŸ¥çš„è®¾è®¡æ–¹æ¡ˆ'
                ],
                systemPrompt: 'ä½ æ˜¯å­¦æœ¯ç ”ç©¶ä¸“å®¶ï¼Œç†Ÿæ‚‰å„å­¦ç§‘çš„ç ”ç©¶æ–¹æ³•å’Œå†™ä½œè§„èŒƒã€‚æ“…é•¿ååŠ©æ–‡çŒ®ç»¼è¿°ã€è®ºæ–‡æ’°å†™ã€ç ”ç©¶è®¾è®¡ç­‰å­¦æœ¯å·¥ä½œã€‚'
            }
        };
        
        // ==================== åˆå§‹åŒ– ====================
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadHistory();
            updateExamples();
            
            // æ¢å¤API Key
            if (state.apiKey) {
                document.getElementById('apiKeyInput').value = state.apiKey;
            }
            
            // åœºæ™¯åˆ‡æ¢
            document.querySelectorAll('.scenario-tab').forEach(tab => {
                tab.addEventListener('click', () => switchScenario(tab.dataset.scenario));
            });
        });
        
        // ==================== åœºæ™¯åˆ‡æ¢ ====================
        function switchScenario(scenario) {
            state.currentScenario = scenario;
            
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.scenario-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.scenario === scenario);
            });
            
            // æ›´æ–°é¢æ¿å†…å®¹
            const config = scenarios[scenario];
            document.getElementById('panelTitle').textContent = config.title;
            document.getElementById('userInput').placeholder = config.placeholder;
            
            updateExamples();
        }
        
        function updateExamples() {
            const config = scenarios[state.currentScenario];
            const examplesContainer = document.getElementById('examples');
            examplesContainer.innerHTML = config.examples.map(ex => 
                `<button class="example-chip" onclick="fillExample('${ex}')">${ex}</button>`
            ).join('');
        }
        
        function fillExample(text) {
            document.getElementById('userInput').value = text;
        }
        
        // ==================== APIè®¾ç½® ====================
        function saveApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            if (apiKey) {
                state.apiKey = apiKey;
                localStorage.setItem('ai_api_key', apiKey);
                showToast('API Key å·²ä¿å­˜');
            } else {
                state.apiKey = '';
                localStorage.removeItem('ai_api_key');
                showToast('API Key å·²æ¸…é™¤');
            }
        }
        
        // ==================== æ€ç»´é“¾å±•ç¤º ====================
        function showThinking(thinking) {
            const chain = document.getElementById('thinkingChain');
            const content = document.getElementById('thinkingContent');
            
            content.innerHTML = `
                <div class="thinking-item">
                    <span class="thinking-icon role">ğŸ‘¤</span>
                    <span><strong>è§’è‰²ï¼š</strong>${thinking.role}</span>
                </div>
                <div class="thinking-item">
                    <span class="thinking-icon task">ğŸ“</span>
                    <span><strong>ä»»åŠ¡ï¼š</strong>${thinking.task}</span>
                </div>
                <div class="thinking-item">
                    <span class="thinking-icon format">ğŸ“„</span>
                    <span><strong>æ ¼å¼ï¼š</strong>${thinking.format}</span>
                </div>
                <div class="thinking-item">
                    <span class="thinking-icon constraint">âš ï¸</span>
                    <span><strong>çº¦æŸï¼š</strong>${thinking.constraint}</span>
                </div>
            `;
            
            chain.style.display = 'block';
        }
        
        function hideThinking() {
            document.getElementById('thinkingChain').style.display = 'none';
        }
        
        // ==================== ç”Ÿæˆæç¤ºè¯ ====================
        async function generatePrompt() {
            const userInput = document.getElementById('userInput').value.trim();
            if (!userInput) {
                showToast('è¯·è¾“å…¥ä½ çš„éœ€æ±‚');
                return;
            }
            
            const btn = document.getElementById('generateBtn');
            const output = document.getElementById('promptOutput');
            const feedbackSection = document.getElementById('feedbackSection');
            
            state.isGenerating = true;
            btn.disabled = true;
            btn.classList.add('loading');
            output.textContent = '';
            feedbackSection.style.display = 'none';
            hideThinking();
            
            try {
                let generatedPrompt;
                let thinking;
                
                if (state.apiKey) {
                    // ä½¿ç”¨çœŸå®AI API
                    generatedPrompt = await generateWithAI(userInput);
                } else {
                    // ä½¿ç”¨æœ¬åœ°æ™ºèƒ½å¼•æ“
                    const result = generateWithLocalEngine(userInput);
                    generatedPrompt = result.prompt;
                    thinking = result.thinking;
                }
                
                // æ˜¾ç¤ºæ€ç»´é“¾
                if (thinking) {
                    showThinking(thinking);
                }
                
                output.textContent = generatedPrompt;
                state.lastGenerated = {
                    scenario: state.currentScenario,
                    input: userInput,
                    output: generatedPrompt,
                    timestamp: new Date().toISOString()
                };
                
                feedbackSection.style.display = 'block';
                addToHistory(state.lastGenerated);
                
            } catch (error) {
                output.textContent = `ç”Ÿæˆå¤±è´¥ï¼š${error.message}`;
                document.getElementById('aiStatus').textContent = 'AIå¼‚å¸¸';
                document.getElementById('aiStatus').className = 'ai-status offline';
            } finally {
                state.isGenerating = false;
                btn.disabled = false;
                btn.classList.remove('loading');
            }
        }
        
        // ==================== AI APIè°ƒç”¨ ====================
        async function generateWithAI(userInput) {
            const style = document.getElementById('styleSelect').value;
            const detail = document.getElementById('detailSelect').value;
            const config = scenarios[state.currentScenario];
            
            const styleMap = {
                professional: 'ä¸“ä¸šä¸¥è°¨',
                casual: 'è½»æ¾éšæ„',
                creative: 'åˆ›æ„å‘æ•£',
                concise: 'ç®€æ´æ˜äº†'
            };
            
            const detailMap = {
                brief: 'ç®€è¦',
                standard: 'æ ‡å‡†',
                detailed: 'è¯¦ç»†'
            };
            
            const prompt = `${config.systemPrompt}

ç”¨æˆ·éœ€æ±‚ï¼š${userInput}
è¾“å‡ºé£æ ¼ï¼š${styleMap[style]}
è¯¦ç»†ç¨‹åº¦ï¼š${detailMap[detail]}

è¯·å°†ä»¥ä¸Šéœ€æ±‚è½¬åŒ–ä¸ºä¸€ä¸ªç»“æ„åŒ–çš„AIæç¤ºè¯ï¼ŒåŒ…å«ï¼š
1. è§’è‰²å®šä¹‰ï¼ˆæ˜ç¡®AIåº”è¯¥æ‰®æ¼”ä»€ä¹ˆè§’è‰²ï¼‰
2. ä»»åŠ¡æè¿°ï¼ˆæ¸…æ™°æè¿°éœ€è¦å®Œæˆçš„ä»»åŠ¡ï¼‰
3. è¾“å‡ºè¦æ±‚ï¼ˆæ ¼å¼ã€é£æ ¼ã€é•¿åº¦ç­‰è¦æ±‚ï¼‰
4. çº¦æŸæ¡ä»¶ï¼ˆéœ€è¦éµå®ˆçš„è§„åˆ™æˆ–é™åˆ¶ï¼‰

è¯·ç›´æ¥è¾“å‡ºæœ€ç»ˆçš„æç¤ºè¯å†…å®¹ï¼Œä¸éœ€è¦è§£é‡Šã€‚`;
            
            // è¿™é‡Œä½¿ç”¨ OpenAI API æ ¼å¼
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${state.apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-3.5-turbo',
                    messages: [
                        { role: 'system', content: config.systemPrompt },
                        { role: 'user', content: prompt }
                    ],
                    temperature: 0.7,
                    max_tokens: 1000
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || 'APIè¯·æ±‚å¤±è´¥');
            }
            
            const data = await response.json();
            return data.choices[0].message.content.trim();
        }
        
        // ==================== æœ¬åœ°æ™ºèƒ½å¼•æ“ ====================
        function generateWithLocalEngine(userInput) {
            const style = document.getElementById('styleSelect').value;
            const detail = document.getElementById('detailSelect').value;
            const config = scenarios[state.currentScenario];
            
            // æ™ºèƒ½åˆ†æç”¨æˆ·è¾“å…¥
            const analysis = analyzeInput(userInput);
            
            // æ„å»ºæ€ç»´é“¾
            const thinking = {
                role: getRoleForScenario(state.currentScenario, analysis),
                task: analysis.task || userInput,
                format: getFormatDescription(style, detail),
                constraint: getConstraintDescription(state.currentScenario)
            };
            
            // æ ¹æ®åœºæ™¯ç”Ÿæˆä¸“ä¸šæç¤ºè¯
            let prompt = '';
            
            // è§’è‰²å®šä¹‰
            prompt += `## è§’è‰²\n`;
            prompt += `${thinking.role}\n\n`;
            
            // ä»»åŠ¡æè¿°
            prompt += `## ä»»åŠ¡\n`;
            prompt += `${thinking.task}\n\n`;
            
            // è¾“å‡ºè¦æ±‚
            prompt += `## è¾“å‡ºè¦æ±‚\n`;
            prompt += getOutputRequirements(state.currentScenario, style, detail);
            prompt += `\n\n`;
            
            // çº¦æŸæ¡ä»¶
            prompt += `## çº¦æŸæ¡ä»¶\n`;
            prompt += getConstraints(state.currentScenario, analysis);
            
            return { prompt, thinking };
        }
        
        function analyzeInput(input) {
            const analysis = {
                task: '',
                target: '',
                keywords: [],
                tone: 'neutral'
            };
            
            // æå–å…³é”®ä¿¡æ¯
            if (input.includes('å†™') || input.includes('åˆ›ä½œ') || input.includes('ç”Ÿæˆ')) {
                analysis.task = input;
            }
            
            // æ£€æµ‹è¯­æ°”
            if (input.includes('ä¸“ä¸š') || input.includes('æ­£å¼')) {
                analysis.tone = 'professional';
            } else if (input.includes('è½»æ¾') || input.includes('éšæ„')) {
                analysis.tone = 'casual';
            } else if (input.includes('åˆ›æ„') || input.includes('æœ‰è¶£')) {
                analysis.tone = 'creative';
            }
            
            return analysis;
        }
        
        function getRoleForScenario(scenario, analysis) {
            const roles = {
                general: 'ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„AIåŠ©æ‰‹ï¼Œæ“…é•¿ç†è§£ç”¨æˆ·éœ€æ±‚å¹¶æä¾›é«˜è´¨é‡çš„å›ç­”ã€‚',
                xiaohongshu: 'ä½ æ˜¯å°çº¢ä¹¦èµ„æ·±ç§è‰åšä¸»ï¼Œæ“…é•¿åˆ›ä½œçœŸå®ã€äº²åˆ‡ã€æœ‰æ„ŸæŸ“åŠ›çš„ç§è‰æ–‡æ¡ˆã€‚ä½ æ‡‚å¾—è¿ç”¨emojiã€åˆ†æ®µã€å…³é”®è¯ç­‰æŠ€å·§ï¼Œè®©å†…å®¹æ›´å…·å¸å¼•åŠ›ã€‚',
                code: 'ä½ æ˜¯èµ„æ·±å…¨æ ˆå·¥ç¨‹å¸ˆï¼Œæ‹¥æœ‰10å¹´å¼€å‘ç»éªŒï¼Œæ“…é•¿ç¼–å†™æ¸…æ™°ã€é«˜æ•ˆã€å¯ç»´æŠ¤çš„ä»£ç ã€‚',
                marketing: 'ä½ æ˜¯èµ„æ·±è¥é”€æ–‡æ¡ˆç­–åˆ’ä¸“å®¶ï¼Œæ·±è°™æ¶ˆè´¹è€…å¿ƒç†ï¼Œæ“…é•¿åˆ›ä½œæœ‰è¯´æœåŠ›çš„è¥é”€æ–‡æ¡ˆã€‚',
                academic: 'ä½ æ˜¯å­¦æœ¯ç ”ç©¶ä¸“å®¶ï¼Œç†Ÿæ‚‰å„å­¦ç§‘çš„ç ”ç©¶æ–¹æ³•å’Œå†™ä½œè§„èŒƒï¼Œæ“…é•¿ååŠ©é«˜è´¨é‡çš„å­¦æœ¯å†™ä½œã€‚'
            };
            return roles[scenario] || roles.general;
        }
        
        function getFormatDescription(style, detail) {
            const styleMap = {
                professional: 'ä¸“ä¸šä¸¥è°¨é£æ ¼',
                casual: 'è½»æ¾éšæ„é£æ ¼',
                creative: 'åˆ›æ„å‘æ•£é£æ ¼',
                concise: 'ç®€æ´æ˜äº†é£æ ¼'
            };
            
            const detailMap = {
                brief: 'ç®€è¦è¾“å‡º',
                standard: 'æ ‡å‡†è¯¦ç»†åº¦',
                detailed: 'è¯¦ç»†å±•å¼€'
            };
            
            return `${styleMap[style]}ï¼Œ${detailMap[detail]}`;
        }
        
        function getConstraintDescription(scenario) {
            const constraints = {
                general: 'ç¡®ä¿å†…å®¹å‡†ç¡®ã€çœŸå®ï¼Œé¿å…æ•æ„Ÿä¿¡æ¯',
                xiaohongshu: 'ä¿æŒçœŸå®åˆ†äº«æ„Ÿï¼Œé¿å…è¿‡åº¦è¥é”€',
                code: 'ä»£ç å¥å£®ï¼Œè€ƒè™‘è¾¹ç•Œæƒ…å†µ',
                marketing: 'éµå®ˆå¹¿å‘Šæ³•ï¼Œä¸å¤¸å¤§å®£ä¼ ',
                academic: 'å¼•ç”¨è§„èŒƒï¼Œé¿å…æŠ„è¢­'
            };
            return constraints[scenario] || constraints.general;
        }
        
        function getOutputRequirements(scenario, style, detail) {
            const requirements = [];
            
            // é£æ ¼è¦æ±‚
            const styleReq = {
                professional: '- è¯­æ°”ä¸“ä¸šä¸¥è°¨ï¼Œç”¨è¯å‡†ç¡®\n- é€»è¾‘æ¸…æ™°ï¼Œç»“æ„å®Œæ•´',
                casual: '- è¯­æ°”è½»æ¾è‡ªç„¶ï¼Œåƒæœ‹å‹èŠå¤©\n- ä½¿ç”¨å£è¯­åŒ–è¡¨è¾¾',
                creative: '- åˆ›æ„ç‹¬ç‰¹ï¼Œè§’åº¦æ–°é¢–\n- è¯­è¨€ç”ŸåŠ¨æœ‰è¶£',
                concise: '- ç®€æ´æ˜äº†ï¼Œç›´å‡»è¦ç‚¹\n- é¿å…å†—ä½™æè¿°'
            };
            requirements.push(styleReq[style] || styleReq.professional);
            
            // è¯¦ç»†ç¨‹åº¦
            const detailReq = {
                brief: '- è¾“å‡ºæ§åˆ¶åœ¨200å­—ä»¥å†…\n- åªä¿ç•™æ ¸å¿ƒè¦ç‚¹',
                standard: '- è¾“å‡ºæ§åˆ¶åœ¨500å­—å·¦å³\n- åŒ…å«å¿…è¦ç»†èŠ‚',
                detailed: '- è¾“å‡º800å­—ä»¥ä¸Š\n- è¯¦ç»†å±•å¼€æ¯ä¸ªè¦ç‚¹'
            };
            requirements.push(detailReq[detail] || detailReq.standard);
            
            // åœºæ™¯ç‰¹å®šè¦æ±‚
            if (scenario === 'xiaohongshu') {
                requirements.push('- ä½¿ç”¨é€‚å½“çš„emojiå¢åŠ äº²å’ŒåŠ›\n- åˆ†æ®µæ¸…æ™°ï¼Œæ¯æ®µä¸å®œè¿‡é•¿\n- åŒ…å«çœŸå®çš„ä½¿ç”¨ä½“éªŒæè¿°');
            } else if (scenario === 'code') {
                requirements.push('- æä¾›å®Œæ•´çš„ä»£ç å®ç°\n- åŒ…å«å¿…è¦çš„æ³¨é‡Šè¯´æ˜\n- ç»™å‡ºä½¿ç”¨ç¤ºä¾‹');
            } else if (scenario === 'marketing') {
                requirements.push('- çªå‡ºäº§å“/æœåŠ¡æ ¸å¿ƒä»·å€¼\n- å¼•å‘ç›®æ ‡ç”¨æˆ·å…±é¸£\n- åŒ…å«æ˜ç¡®çš„è¡ŒåŠ¨å·å¬');
            } else if (scenario === 'academic') {
                requirements.push('- ä½¿ç”¨è§„èŒƒçš„å­¦æœ¯è¯­è¨€\n- é€»è¾‘ä¸¥å¯†ï¼Œè®ºè¯å……åˆ†\n- æ­£ç¡®å¼•ç”¨ç›¸å…³æ–‡çŒ®');
            }
            
            return requirements.join('\n');
        }
        
        function getConstraints(scenario, analysis) {
            const constraints = [
                '- ç¡®ä¿å†…å®¹å‡†ç¡®ã€çœŸå®',
                '- é¿å…ä½¿ç”¨æ•æ„Ÿæˆ–ä¸å½“å†…å®¹'
            ];
            
            if (scenario === 'xiaohongshu') {
                constraints.push('- é¿å…è¿‡åº¦è¥é”€æ„Ÿï¼Œä¿æŒçœŸå®åˆ†äº«çš„æ„Ÿè§‰');
                constraints.push('- é€‚å½“ä½¿ç”¨å°çº¢ä¹¦çƒ­é—¨å…³é”®è¯');
            } else if (scenario === 'code') {
                constraints.push('- ä»£ç éœ€è€ƒè™‘è¾¹ç•Œæƒ…å†µå¤„ç†');
                constraints.push('- éµå¾ªæœ€ä½³å®è·µå’Œç¼–ç è§„èŒƒ');
            } else if (scenario === 'marketing') {
                constraints.push('- éµå®ˆå¹¿å‘Šæ³•ç›¸å…³è§„å®š');
                constraints.push('- ä¸å¤¸å¤§äº§å“åŠŸæ•ˆ');
            } else if (scenario === 'academic') {
                constraints.push('- éµå¾ªå­¦æœ¯è¯šä¿¡åŸåˆ™');
                constraints.push('- å¼•ç”¨æ¥æºéœ€å‡†ç¡®æ ‡æ³¨');
            }
            
            return constraints.join('\n');
        }
        
        // ==================== åé¦ˆæœºåˆ¶ ====================
        function submitFeedback(type) {
            if (!state.lastGenerated) return;
            
            // æ›´æ–°ç»Ÿè®¡
            state.feedback[type]++;
            saveStats();
            updateStatsDisplay();
            
            // æ ‡è®°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.feedback-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector(`.feedback-btn.${type}`).classList.add('selected');
            
            // ä¿å­˜åé¦ˆåˆ°å†å²è®°å½•
            const historyItem = state.history.find(h => 
                h.timestamp === state.lastGenerated.timestamp
            );
            if (historyItem) {
                historyItem.feedback = type;
                saveHistory();
            }
            
            showToast('æ„Ÿè°¢ä½ çš„åé¦ˆï¼æˆ‘ä»¬ä¼šæŒç»­ä¼˜åŒ–ç”Ÿæˆæ•ˆæœã€‚');
        }
        
        function saveStats() {
            localStorage.setItem('prompt_generator_stats', JSON.stringify(state.feedback));
        }
        
        function loadStats() {
            const saved = localStorage.getItem('prompt_generator_stats');
            if (saved) {
                state.feedback = JSON.parse(saved);
                updateStatsDisplay();
            }
        }
        
        function updateStatsDisplay() {
            document.getElementById('statGood').textContent = state.feedback.good;
            document.getElementById('statMid').textContent = state.feedback.mid;
            document.getElementById('statBad').textContent = state.feedback.bad;
        }
        
        // ==================== å†å²è®°å½• ====================
        function addToHistory(item) {
            state.history.unshift(item);
            if (state.history.length > 10) {
                state.history = state.history.slice(0, 10);
            }
            saveHistory();
            renderHistory();
        }
        
        function saveHistory() {
            localStorage.setItem('prompt_generator_history', JSON.stringify(state.history));
        }
        
        function loadHistory() {
            const saved = localStorage.getItem('prompt_generator_history');
            if (saved) {
                state.history = JSON.parse(saved);
                renderHistory();
            }
        }
        
        function renderHistory() {
            const container = document.getElementById('historyList');
            if (state.history.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #94a3b8; padding: 20px;">æš‚æ— å†å²è®°å½•</div>';
                return;
            }
            
            container.innerHTML = state.history.map(item => {
                const date = new Date(item.timestamp);
                const timeStr = `${date.getMonth()+1}/${date.getDate()} ${date.getHours()}:${String(date.getMinutes()).padStart(2, '0')}`;
                const typeClass = item.scenario;
                const typeLabel = {
                    general: 'é€šç”¨',
                    xiaohongshu: 'å°çº¢ä¹¦',
                    code: 'ä»£ç ',
                    marketing: 'è¥é”€',
                    academic: 'å­¦æœ¯'
                }[item.scenario];
                
                return `
                    <div class="history-item" onclick="loadHistoryItem('${item.timestamp}')">
                        <div class="history-item-header">
                            <span class="history-item-type ${typeClass}">${typeLabel}</span>
                            <span class="history-item-time">${timeStr}</span>
                        </div>
                        <div class="history-item-preview">${item.input}</div>
                    </div>
                `;
            }).join('');
        }
        
        function loadHistoryItem(timestamp) {
            const item = state.history.find(h => h.timestamp === timestamp);
            if (item) {
                switchScenario(item.scenario);
                document.getElementById('userInput').value = item.input;
                document.getElementById('promptOutput').textContent = item.output;
                document.getElementById('feedbackSection').style.display = 'block';
                state.lastGenerated = item;
                
                // æ¢å¤åé¦ˆçŠ¶æ€
                document.querySelectorAll('.feedback-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                if (item.feedback) {
                    document.querySelector(`.feedback-btn.${item.feedback}`).classList.add('selected');
                }
            }
        }
        
        function clearHistory() {
            state.history = [];
            saveHistory();
            renderHistory();
            showToast('å†å²è®°å½•å·²æ¸…ç©º');
        }
        
        // ==================== å·¥å…·å‡½æ•° ====================
        function copyResult() {
            const output = document.getElementById('promptOutput').textContent;
            if (!output) {
                showToast('æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹');
                return;
            }
            
            navigator.clipboard.writeText(output).then(() => {
                showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }).catch(() => {
                showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
            });
        }
        
        function clearResult() {
            document.getElementById('promptOutput').textContent = '';
            document.getElementById('feedbackSection').style.display = 'none';
            hideThinking();
            document.querySelectorAll('.feedback-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            state.lastGenerated = null;
        }
        
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
